<!DOCTYPE html>
<html>
    <head>
        <title>SmylerBTE API - Zooms</title>
        <meta charset="utf-8">
        <meta name="keywords" content="DavixDevelop,David  Rupnik,Twitch Multifunction,Twitch Account Inforamtion,MP3 Tag Edit">
        <meta name="msvalidate.01" content="335884A4EF4C6AF15937AD225531D92C" />
        <meta name="author" content="David Rupnik" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link rel="stylesheet" href="css/flexboxgrid.min.css" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="image_src" href="./favicon.ico" />
        <link href="../../../images/website-logo.png" type="image/x-icon" rel="shortcut icon">
    </head>
    <body>
        <div class="widget-container">
            <div class="zoom-widget">
                <div class="row">
                    <form id="lonForm">
                        <div class="input-group">
                            <label for="lon">Your resolution (m):</label>
                            <input id="met" class="input-box" type="number" step="0.00001" min="0" value="1" name="met">
                        </div>
                        <div class="input-group">
                            <label for="lon">Latitude:</label>
                            <input id="lon" class="input-box" type="number" step="0.00000000000001" min="-90" max="90" value="0" name="lon">
                        </div>
                        <button class="primary-button" type="submit">Calculate</button>
                    </form>
                </div>
                <div class="row">
                    <table>
                      <thead>
                        <tr>
                          <th scope="col">Zoom</th>
                          <th scope="col">Resolution (m)</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr id="r0">
                          <th scope="row">0</th>
                          <td id="res0"></td>
                        </tr>
                        <tr id="r1">
                          <th scope="row">1</th>
                          <td id="res1"></td>
                        </tr>
                        <tr id="r2">
                          <th scope="row">2</th>
                          <td id="res2"></td>
                        </tr>
                        <tr id="r3">
                          <th scope="row">3</th>
                          <td id="res3"></td>
                        </tr>
                        <tr id="r4">
                          <th scope="row">4</th>
                          <td id="res4"></td>
                        </tr>
                        <tr id="r5">
                          <th scope="row">5</th>
                          <td id="res5"></td>
                        </tr>
                        <tr id="r6">
                          <th scope="row">6</th>
                          <td id="res6"></td>
                        </tr>
                        <tr id="r7">
                          <th scope="row">7</th>
                          <td id="res7"></td>
                        </tr>
                        <tr id="r8">
                          <th scope="row">8</th>
                          <td id="res8"></td>
                        </tr>
                        <tr id="r9">
                          <th scope="row">9</th>
                          <td id="res9"></td>
                        </tr>
                        <tr id="r10">
                          <th scope="row">10</th>
                          <td id="res10"></td>
                        </tr>
                        <tr id="r11">
                          <th scope="row">11</th>
                          <td id="res11"></td>
                        </tr>
                        <tr id="r12">
                          <th scope="row">12</th>
                          <td id="res12"></td>
                        </tr>
                        <tr id="r13">
                          <th scope="row">13</th>
                          <td id="res13"></td>
                        </tr>
                        <tr id="r14">
                          <th scope="row">14</th>
                          <td id="res14"></td>
                        </tr>
                        <tr id="r15">
                          <th scope="row">15</th>
                          <td id="res15"></td>
                        </tr>
                        <tr id="r16">
                          <th scope="row">16</th>
                          <td id="res16"></td>
                        </tr>
                        <tr id="r17">
                          <th scope="row">17</th>
                          <td id="res17"></td>
                        </tr>
                        <tr id="r18">
                          <th scope="row">18</th>
                          <td id="res18"></td>
                        </tr>
                        <tr id="r19">
                          <th scope="row">19</th>
                          <td id="res19"></td>
                        </tr>
                        <tr id="r20">
                          <th scope="row">20</th>
                          <td id="res20"></td>
                        </tr>
                      </tbody>
                    </table>
                </div>
                <div class="credit-div">
                    <p>Powered by: </p>
                    <img src="https://avatars.githubusercontent.com/u/19222559?s=400&u=3d42ec1555604fff34ec22b8b6f170fed577407f&v=4">
                    <a href="https://github.com/SmylerMC/smyler-bte-api">Symler BTE API</a>
                </div>
            </div>
        </div>
        <div id="popc" class="popup-container" style="display: none;">
            <div id="pop" class="popup" style="display: none;">
                <p>Your prefered zoom is</p>
                <p id="zoom">17</p>
                <button id="closePopup" class="secondary-button">OK</button>
            </div>
        </div>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript">
            function renderResoultion(data){
                for (var c = 0; c < data.resolution.length; c++) {
                    $("#res" + c.toString()).html(data.resolution[c].toString())
                }
            }

            function selectItems(data,updateUi){
                var found = false
                var meter = parseFloat($("#met").val())
                var zoom = -1
                for (var c = 0; c < data.resolution.length; c++) {
                    if(data.resolution[c] <= meter && found == false) {
                        if(!$("#r" + c.toString()).hasClass("sel") && updateUi) {
                            $("#r" + c.toString()).toggleClass("sel")
                        }
                        found = true
                        zoom = c
                        if(data.resolution[c] < meter){
                            if(data.resolution[c - 1] > meter){
                                if(!$("#r" + (c - 1).toString()).hasClass("sel") && updateUi) {
                                    $("#r" + (c - 1).toString()).toggleClass("sel")
                                }

                                first_diff = data.resolution[c - 1] - meter
                                second_diff = meter - data.resolution[c]
                                if (first_diff < second_diff) {
                                    zoom = c - 1
                                }
                            }
                        }
                    } else {
                        if($("#r" + c.toString()).hasClass("sel") && updateUi) {
                            $("#r" + c.toString()).toggleClass("sel")
                        }
                    }
                }

                return zoom
            }

            $( document ).ready(function() {
                $.ajax({
                    url: "https://smybteapi.thesmyler.fr/webmercator/resolution?latitude=0",
                    dataType: "json",
                    success: function(data){
                        renderResoultion(data)
                        selectItems(data, true)
                    }
                });
                $("#lonForm").submit(function( event ) {
                  $.ajax({
                    url: "https://smybteapi.thesmyler.fr/webmercator/resolution?latitude=" + $("#lon").val(),
                    dataType: "json",
                    success: function(data){
                        renderResoultion(data)
                        zoom = selectItems(data, false)
                        $("#zoom").html(zoom.toString())
                        $("#popc").show(200, function(){
                            selectItems(data, true)
                            $("#pop").show(200);
                        });

                    }
                });
                  event.preventDefault();
                });

                $("#closePopup").click(function(){
                    $("#pop").hide(200, function(){
                        $("#popc").hide(200);
                    });

                })
            });
        </script>
    </body>
</html>
